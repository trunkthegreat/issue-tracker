<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Issue Tracker</title>
    <style>
        /* main.css - Common shared styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d5016 0%, #3a6b1a 25%, #4a7c23 50%, #1a4010 75%, #0f2908 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Glassmorphic elements */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Collapsible sections */
        .collapsible {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .collapsible:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .collapsible-content {
            padding: 0 20px 20px 20px;
            transition: all 0.3s ease;
        }

        .collapsed .collapsible-content {
            display: none;
        }

        .collapse-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #a8e6cf, #dcedc8, #f8bbd9);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            color: #b8e6b8;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Authentication section */
        .auth-section {
            padding: 0;
            margin-bottom: 30px;
            text-align: center;
        }

        .token-input {
            width: 100%;
            max-width: 500px;
            padding: 15px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #2d5016;
            font-size: 16px;
            border: 3px solid rgba(168, 230, 207, 0.5);
        }

        .token-input:focus {
            outline: none;
            border-color: #a8e6cf;
            box-shadow: 0 0 20px rgba(168, 230, 207, 0.3);
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-sm {
            padding: 8px 20px;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #a8e6cf, #dcedc8);
            color: #2d5016;
            border-color: #a8e6cf;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(168, 230, 207, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f8bbd9, #ffcccb);
            color: #8b0000;
            border-color: #f8bbd9;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(248, 187, 217, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #90ee90, #98fb98);
            color: #006400;
            border-color: #90ee90;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ffb3ba, #ffc0cb);
            color: #8b0000;
            border-color: #ffb3ba;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffd700, #ffff99);
            color: #8b6914;
            border-color: #ffd700;
        }

        /* Navigation */
        .nav-section {
            padding: 30px;
            margin-bottom: 20px;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .nav-card {
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .nav-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.1);
        }

        .nav-card h3 {
            font-size: 1.3em;
            margin-bottom: 8px;
            color: #a8e6cf;
        }

        .nav-card p {
            color: #b8e6b8;
            line-height: 1.4;
            font-size: 0.9em;
        }

        /* Status indicators */
        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin: 5px;
        }

        .status-authenticated {
            background: rgba(144, 238, 144, 0.8);
            color: #006400;
        }

        .status-unauthenticated {
            background: rgba(255, 179, 186, 0.8);
            color: #8b0000;
        }

        .critical-low { background: rgba(144, 238, 144, 0.8); color: #006400; }
        .critical-medium { background: rgba(255, 255, 0, 0.8); color: #8b6914; }
        .critical-high { background: rgba(255, 165, 0, 0.8); color: #8b4513; }
        .critical-urgent { background: rgba(255, 0, 0, 0.8); color: #ffffff; }

        /* Scrollable containers */
        .scrollable {
            max-height: 70vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(168, 230, 207, 0.5) transparent;
        }

        .scrollable::-webkit-scrollbar {
            width: 8px;
        }

        .scrollable::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .scrollable::-webkit-scrollbar-thumb {
            background: rgba(168, 230, 207, 0.5);
            border-radius: 10px;
        }

        .scrollable::-webkit-scrollbar-thumb:hover {
            background: rgba(168, 230, 207, 0.7);
        }

        /* Hidden sections */
        .hidden {
            display: none;
        }

        /* Form styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #a8e6cf;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #2d5016;
            font-size: 14px;
            border: 2px solid rgba(168, 230, 207, 0.3);
        }

        .form-control:focus {
            outline: none;
            border-color: #a8e6cf;
            box-shadow: 0 0 10px rgba(168, 230, 207, 0.3);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* Issue cards */
        .issue-card {
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 5px solid #a8e6cf;
        }

        .issue-card:hover {
            transform: translateX(10px);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
        }

        .issue-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #a8e6cf;
            margin-bottom: 8px;
        }

        .issue-meta {
            font-size: 0.9em;
            color: #b8e6b8;
            margin-bottom: 10px;
        }

        .issue-content {
            color: #ffffff;
            line-height: 1.5;
            margin-bottom: 10px;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Table view */
        .table-view {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .table-view th,
        .table-view td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-view th {
            background: rgba(168, 230, 207, 0.2);
            color: #a8e6cf;
            font-weight: bold;
        }

        .table-view tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Media preview */
        .media-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            margin: 10px;
            border: 2px solid rgba(168, 230, 207, 0.5);
        }

        /* Voice recording */
        .voice-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .recording-indicator {
            width: 20px;
            height: 20px;
            background: #ff0000;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
        }

        .notification.error {
            background: linear-gradient(45deg, #f44336, #e57373);
        }

        .notification.warning {
            background: linear-gradient(45deg, #ff9800, #ffb74d);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* Filter controls */
        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        /* View toggle */
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .view-toggle button.active {
            background: linear-gradient(45deg, #a8e6cf, #dcedc8);
            color: #2d5016;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .nav-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }

            .filter-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>🌿 GitHub Issue Tracker</h1>
        <p>Comprehensive Issue Management System</p>
    </div>

    <div class="container">
        <!-- Authentication Section -->
        <div class="glass auth-section collapsible" id="authSection">
            <div class="collapsible-header" onclick="toggleCollapse('authSection')">
                <h2>🔐 GitHub Authentication</h2>
                <span class="collapse-icon">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Enter your GitHub Personal Access Token to enable repository access</p>
                <div style="margin: 20px 0;">
                    <input type="password" class="token-input" id="githubToken" placeholder="Enter GitHub Personal Access Token">
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="authenticateToken()">Authenticate</button>
                        <button class="btn btn-secondary" onclick="clearToken()">Clear Token</button>
                    </div>
                </div>
                <div id="authStatus">
                    <span class="status status-unauthenticated">Not Authenticated</span>
                </div>
            </div>
        </div>

        <!-- Navigation Section -->
        <div class="glass nav-section" id="navSection">
            <h2 style="text-align: center; margin-bottom: 30px; color: #a8e6cf;">Application Modules</h2>
            <div class="nav-grid">
                <div class="glass-dark nav-card" onclick="showDashboard()">
                    <h3>📊 Dashboard</h3>
                    <p>Overview and statistics</p>
                </div>
                <div class="glass-dark nav-card" onclick="showIssueLogger()">
                    <h3>📝 Issue Logger</h3>
                    <p>Create and manage issues</p>
                </div>
                <div class="glass-dark nav-card" onclick="showSearchIssues()">
                    <h3>🔍 Search Issues</h3>
                    <p>Advanced search and filtering</p>
                </div>
                <div class="glass-dark nav-card" onclick="showIssueList()">
                    <h3>📋 Issue List</h3>
                    <p>Browse all issues</p>
                </div>
                <div class="glass-dark nav-card" onclick="showReport()">
                    <h3>📈 Reports</h3>
                    <p>Analytics and reports</p>
                </div>
                <div class="glass-dark nav-card" onclick="showIssueViewer()">
                    <h3>👁️ Issue Viewer</h3>
                    <p>Detailed issue view</p>
                </div>
                <div class="glass-dark nav-card" onclick="showCategoryManager()">
                    <h3>🗂️ Categories</h3>
                    <p>Manage categories</p>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div class="glass scrollable hidden" id="dashboardSection">
            <div style="padding: 30px;">
                <h2 style="color: #a8e6cf; margin-bottom: 20px;">📊 Dashboard</h2>
                <div id="dashboardContent">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div class="glass-dark" style="padding: 15px; text-align: center;">
                            <h4 style="color: #a8e6cf;">Total Issues</h4>
                            <div style="font-size: 1.8em; color: #ffffff;" id="totalIssues">0</div>
                        </div>
                        <div class="glass-dark" style="padding: 15px; text-align: center;">
                            <h4 style="color: #a8e6cf;">Open Issues</h4>
                            <div style="font-size: 1.8em; color: #ffffff;" id="openIssues">0</div>
                        </div>
                        <div class="glass-dark" style="padding: 15px; text-align: center;">
                            <h4 style="color: #a8e6cf;">Closed Issues</h4>
                            <div style="font-size: 1.8em; color: #ffffff;" id="closedIssues">0</div>
                        </div>
                    </div>

                    <h3 style="color: #a8e6cf; margin-bottom: 15px;">Open Issues by Critical Level</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;" id="criticalLevelStats">
                    </div>
                    
                    <h3 style="color: #a8e6cf; margin-bottom: 15px;">Recent Issues</h3>
                    <div id="recentIssues"></div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="showIssueLogger()">📝 Create New Issue</button>
                        <button class="btn btn-success" onclick="refreshData()">🔄 Refresh Data</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Issue Logger Section -->
        <div class="glass scrollable hidden" id="issueLoggerSection">
            <div style="padding: 30px;">
                <h2 style="color: #a8e6cf; margin-bottom: 20px;">📝 Issue Logger</h2>
                
                <!-- Create New Issue Form -->
                <div class="glass-dark collapsible" style="margin-bottom: 30px;">
                    <div class="collapsible-header" onclick="toggleCollapse('createIssueForm')">
                        <h3 style="color: #a8e6cf;">Create New Issue</h3>
                        <span class="collapse-icon">▼</span>
                    </div>
                    <div class="collapsible-content" id="createIssueForm">
                        <form id="issueForm">
                            <div class="form-group">
                                <label for="issueTitle">Issue Title</label>
                                <input type="text" class="form-control" id="issueTitle" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="issueContent">Issue Content</label>
                                <textarea class="form-control" id="issueContent" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="criticalLevel">Critical Level</label>
                                <select class="form-control" id="criticalLevel" required>
                                    <option value="low">🟢 Low</option>
                                    <option value="medium">🟡 Medium</option>
                                    <option value="high">🟠 High</option>
                                    <option value="urgent">🔴 Urgent</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="resolutionMethod">Resolution Method</label>
                                <textarea class="form-control" id="resolutionMethod"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="expectedDate">Expected Resolution Date</label>
                                <input type="datetime-local" class="form-control" id="expectedDate">
                            </div>
                            
                            <div class="form-group">
                                <label for="actualDate">Actual Resolution Date</label>
                                <input type="datetime-local" class="form-control" id="actualDate">
                            </div>
                            
                            <div class="form-group">
                                <label for="issueStatus">Status</label>
                                <select class="form-control" id="issueStatus">
                                    <option value="ongoing">Ongoing</option>
                                    <option value="finished">Finished</option>
                                    <option value="pending">Pending</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select class="form-control" id="category">
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="mediaFiles">Upload Media Files</label>
                                <input type="file" class="form-control" id="mediaFiles" multiple accept="image/*,audio/*">
                                <div id="mediaPreview" style="margin-top: 15px;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label>Voice Recording</label>
                                <div class="voice-controls">
                                    <button type="button" class="btn btn-danger" id="recordBtn" onclick="toggleRecording()">🎤 Start Recording</button>
                                    <button type="button" class="btn btn-secondary" id="stopBtn" onclick="stopRecording()" disabled>⏹️ Stop</button>
                                    <button type="button" class="btn btn-primary" id="playBtn" onclick="playRecording()" disabled>▶️ Play</button>
                                    <div id="recordingIndicator" class="recording-indicator hidden"></div>
                                </div>
                                <audio id="audioPreview" controls style="width: 100%; margin-top: 10px; display: none;"></audio>
                            </div>
                            
                            <div style="text-align: center; margin-top: 30px;">
                                <button type="submit" class="btn btn-success">💾 Save Issue</button>
                                <button type="button" class="btn btn-secondary" onclick="resetForm()">🔄 Reset Form</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Issues Section -->
        <div class="glass scrollable hidden" id="searchIssuesSection">
            <div style="padding: 30px;">
                <h2 style="color: #a8e6cf; margin-bottom: 20px;">🔍 Search Issues</h2>
                
                <div class="glass-dark" style="padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #a8e6cf; margin-bottom: 15px;">Search & Filter</h3>
                    <div class="form-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="Search issues (supports multiple keywords separated by commas)...">
                    </div>
                    
                    <div class="filter-controls">
                        <div class="form-group">
                            <label for="filterStatus">Status</label>
                            <select class="form-control" id="filterStatus">
                                <option value="">All Status</option>
                                <option value="ongoing">Ongoing</option>
                                <option value="finished">Finished</option>
                                <option value="pending">Pending</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="filterCritical">Critical Level</label>
                            <select class="form-control" id="filterCritical">
                                <option value="">All Levels</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="filterCategory">Category</label>
                            <select class="form-control" id="filterCategory">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="filterDateFrom">Date From</label>
                            <input type="date" class="form-control" id="filterDateFrom">
                        </div>
                        
                        <div class="form-group">
                            <label for="filterDateTo">Date To</label>
                            <input type="date" class="form-control" id="filterDateTo">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="performSearch()">🔍 Search</button>
                        <button class="btn btn-secondary" onclick="clearSearch()">🔄 Clear</button>
                    </div>
                </div>

                <div class="glass-dark" style="padding: 20px;">
                    <h3 style="color: #a8e6cf; margin-bottom: 15px;">Search Results</h3>
                    <div id="searchResults"></div>
                </div>
            </div>
        </div>

        <!-- Issue List Section -->
        <div class="glass scrollable hidden" id="issueListSection">
            <div style="padding: 30px;">
                <h2 style="color: #a8e6cf; margin-bottom: 20px;">📋 Issue List</h2>
                
                <div class="glass-dark" style="padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: #a8e6cf;">All Issues</h3>
                        <div>
                            <select class="form-control" id="sortBy" style="width: auto; display: inline-block;" onchange="sortIssues()">
                                <option value="date-desc">Latest First</option>
                                <option value="date-asc">Oldest First</option>
                                <option value="title-asc">A-Z</option>
                                <option value="title-desc">Z-A</option>
                                <option value="critical">Critical Level</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="view-toggle">
                        <button class="btn btn-sm active" id="viewThumbnails" onclick="setViewMode('thumbnails')">🔲 Thumbnails</button>
                        <button class="btn btn-sm" id="viewTable" onclick="setViewMode('table')">📋 Table</button>
                    </div>
                </div>

                <div class="glass-dark" style="padding: 20px;">
                    <div id="issueListContent"></div>
                </div>
            </div>
        </div>

        <!-- Report Section -->
        <div class="glass scrollable hidden" id="reportSection">
            <div style="padding: 30px;">
                <h2 style="color: #a8e6cf; margin-bottom: 20px;">📈 Closed Issues Report</h2>
                <div id="reportContent">
                    <div class="glass-dark" style="padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #a8e6cf;">Report Summary</h3>
                        <div id="reportSummary"></div>
                    </div>
                    <div class="glass-dark" style="padding: 20px;">
                        <h3 style="color: #a8e6cf;">Closed Issues Details</h3>
                        <div id="closedIssuesList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Issue Viewer Section -->
        <div class="glass scrollable hidden" id="issueViewerSection">
            <div style="padding: 30px;">
                <h2 style="color: #a8e6cf; margin-bottom: 20px;">👁️ Issue Viewer</h2>
                <div id="issueViewerContent">
                    <p style="text-align: center; color: #b8e6b8;">Select an issue to view details</p>
                </div>
            </div>
        </div>

        <!-- Category Manager Section -->
        <div class="glass scrollable hidden" id="categoryManagerSection">
            <div style="padding: 30px;">
                <h2 style="color: #a8e6cf; margin-bottom: 20px;">🗂️ Category Manager</h2>
                
                <div class="glass-dark" style="padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #a8e6cf; margin-bottom: 15px;">Add New Category</h3>
                    <form id="categoryForm">
                        <div style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 10px; align-items: end;">
                            <div class="form-group">
                                <label for="categoryName">Category Name</label>
                                <input type="text" class="form-control" id="categoryName" required>
                            </div>
                            <div class="form-group">
                                <label for="categoryDescription">Description</label>
                                <input type="text" class="form-control" id="categoryDescription">
                            </div>
                            <button type="submit" class="btn btn-success">Add Category</button>
                        </div>
                    </form>
                </div>

                <div class="glass-dark" style="padding: 20px;">
                    <h3 style="color: #a8e6cf; margin-bottom: 15px;">Existing Categories</h3>
                    <div id="categoriesList"></div>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn btn-primary" onclick="showDashboard()">📊 Dashboard</button>
            <button class="btn btn-primary" onclick="showIssueLogger()">📝 Issue Logger</button>
            <button class="btn btn-primary" onclick="showSearchIssues()">🔍 Search</button>
            <button class="btn btn-primary" onclick="showIssueList()">📋 List</button>
            <button class="btn btn-primary" onclick="showReport()">📈 Reports</button>
        </div>
    </div>

    <script>
        // Global variables
        let githubToken = '';
        let isAuthenticated = false;
        let issues = [];
        let categories = [
            { id: 'general', name: 'General', description: 'General issues' },
            { id: 'bug', name: 'Bug', description: 'Software bugs' },
            { id: 'feature', name: 'Feature Request', description: 'New feature requests' },
            { id: 'documentation', name: 'Documentation', description: 'Documentation issues' },
            { id: 'support', name: 'Support', description: 'Support requests' }
        ];
        let mediaRecorder;
        let audioChunks = [];
        let recordedAudio = null;
        let currentViewMode = 'thumbnails';
        let editingIssueId = null;

        const GITHUB_REPO = 'trunkthegreat/issue-tracker';
        const GITHUB_API_BASE = 'https://api.github.com';

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromGitHub();
            populateCategories();
            showDashboard();
            
            // Add real-time search
            document.getElementById('searchInput').addEventListener('input', debounce(performSearch, 300));
        });

        // GitHub API functions
        async function makeGitHubRequest(endpoint, method = 'GET', data = null) {
            if (!isAuthenticated) {
                throw new Error('Not authenticated');
            }

            const options = {
                method,
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                }
            };

            if (data) {
                options.body = JSON.stringify(data);
            }

            const response = await fetch(`${GITHUB_API_BASE}${endpoint}`, options);
            
            if (!response.ok) {
                const error = await response.json().catch(() => ({ message: 'Unknown error' }));
                throw new Error(error.message || `HTTP ${response.status}`);
            }

            return response.json();
        }

        async function saveFileToGitHub(path, content, message) {
            try {
                // Check if file exists to get SHA
                let sha;
                try {
                    const existingFile = await makeGitHubRequest(`/repos/${GITHUB_REPO}/contents/${path}`);
                    sha = existingFile.sha;
                } catch (e) {
                    // File doesn't exist, that's fine
                }

                const data = {
                    message,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
                    ...(sha && { sha })
                };

                await makeGitHubRequest(`/repos/${GITHUB_REPO}/contents/${path}`, 'PUT', data);
                return true;
            } catch (error) {
                console.error('Error saving to GitHub:', error);
                showNotification('Error saving to GitHub: ' + error.message, 'error');
                return false;
            }
        }

        async function loadFileFromGitHub(path) {
            try {
                const response = await makeGitHubRequest(`/repos/${GITHUB_REPO}/contents/${path}`);
                const content = JSON.parse(decodeURIComponent(escape(atob(response.content))));
                return content;
            } catch (error) {
                console.error(`Error loading ${path}:`, error);
                return null;
            }
        }

        async function loadDataFromGitHub() {
            if (!isAuthenticated) return;

            try {
                // Load issues
                const issuesData = await loadFileFromGitHub('issues.json');
                if (issuesData) {
                    issues = issuesData;
                }

                // Load categories
                const categoriesData = await loadFileFromGitHub('database.json');
                if (categoriesData && categoriesData.categories) {
                    categories = categoriesData.categories;
                }

                populateCategories();
                updateDashboard();
                displayIssueList();
            } catch (error) {
                console.error('Error loading data from GitHub:', error);
            }
        }

        async function saveDataToGitHub() {
            if (!isAuthenticated) return false;

            try {
                // Save issues
                await saveFileToGitHub('issues.json', issues, 'Update issues data');
                
                // Save database with categories
                await saveFileToGitHub('database.json', { categories }, 'Update database');
                
                return true;
            } catch (error) {
                console.error('Error saving data to GitHub:', error);
                return false;
            }
        }

        // Authentication functions
        async function authenticateToken() {
            const token = document.getElementById('githubToken').value.trim();
            if (!token) {
                showNotification('Please enter a GitHub token', 'error');
                return;
            }

            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    githubToken = token;
                    isAuthenticated = true;
                    updateAuthStatus();
                    await loadDataFromGitHub();
                    showNotification('Authentication successful!', 'success');
                    
                    // Auto-collapse auth section
                    setTimeout(() => {
                        if (!document.getElementById('authSection').classList.contains('collapsed')) {
                            toggleCollapse('authSection');
                        }
                    }, 2000);
                } else {
                    throw new Error('Invalid token');
                }
            } catch (error) {
                showNotification('Authentication failed: ' + error.message, 'error');
                isAuthenticated = false;
                updateAuthStatus();
            }
        }

        function clearToken() {
            githubToken = '';
            isAuthenticated = false;
            document.getElementById('githubToken').value = '';
            updateAuthStatus();
            issues = [];
            updateDashboard();
            displayIssueList();
            showNotification('Token cleared', 'warning');
        }

        function updateAuthStatus() {
            const statusElement = document.getElementById('authStatus');
            if (isAuthenticated) {
                statusElement.innerHTML = '<span class="status status-authenticated">✅ Authenticated</span>';
            } else {
                statusElement.innerHTML = '<span class="status status-unauthenticated">❌ Not Authenticated</span>';
            }
        }

        // Collapsible functionality
        function toggleCollapse(elementId) {
            const element = document.getElementById(elementId);
            element.classList.toggle('collapsed');
        }

        // Navigation functions
        function hideAllSections() {
            const sections = ['dashboardSection', 'issueLoggerSection', 'searchIssuesSection', 'issueListSection', 'reportSection', 'issueViewerSection', 'categoryManagerSection'];
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }

        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboardSection').classList.remove('hidden');
            updateDashboard();
        }

        function showIssueLogger() {
            hideAllSections();
            document.getElementById('issueLoggerSection').classList.remove('hidden');
        }

        function showSearchIssues() {
            hideAllSections();
            document.getElementById('searchIssuesSection').classList.remove('hidden');
            populateFilterCategories();
            performSearch();
        }

        function showIssueList() {
            hideAllSections();
            document.getElementById('issueListSection').classList.remove('hidden');
            displayIssueList();
        }

        function showReport() {
            hideAllSections();
            document.getElementById('reportSection').classList.remove('hidden');
            generateReport();
        }

        function showIssueViewer() {
            hideAllSections();
            document.getElementById('issueViewerSection').classList.remove('hidden');
        }

        function showCategoryManager() {
            hideAllSections();
            document.getElementById('categoryManagerSection').classList.remove('hidden');
            displayCategories();
        }

        // Issue management functions
        function generateIssueId() {
            return 'issue_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function getCurrentDateTime() {
            return new Date().toISOString();
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'Not set';
            return new Date(dateString).toLocaleString();
        }

        function checkDuplicateIssue(newIssue) {
            const fieldsToCheck = ['title', 'content', 'resolutionMethod', 'expectedDate', 'actualDate', 'status', 'category', 'criticalLevel'];
            
            return issues.some(issue => {
                if (editingIssueId && issue.id === editingIssueId) {
                    return false; // Skip the issue being edited
                }
                
                return fieldsToCheck.every(field => {
                    const newValue = newIssue[field] || '';
                    const existingValue = issue[field] || '';
                    return newValue === existingValue;
                });
            });
        }

        // Form handling
        document.getElementById('issueForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isAuthenticated) {
                showNotification('Please authenticate with GitHub first', 'error');
                return;
            }

            const issue = {
                id: editingIssueId || generateIssueId(),
                title: document.getElementById('issueTitle').value,
                content: document.getElementById('issueContent').value,
                criticalLevel: document.getElementById('criticalLevel').value,
                resolutionMethod: document.getElementById('resolutionMethod').value,
                expectedDate: document.getElementById('expectedDate').value,
                actualDate: document.getElementById('actualDate').value,
                status: document.getElementById('issueStatus').value,
                category: document.getElementById('category').value,
                createdDate: editingIssueId ? issues.find(i => i.id === editingIssueId)?.createdDate || getCurrentDateTime() : getCurrentDateTime(),
                updatedDate: getCurrentDateTime(),
                mediaFiles: [],
                voiceRecording: recordedAudio ? recordedAudio : null
            };

            // Check for duplicates
            if (checkDuplicateIssue(issue)) {
                if (!confirm('⚠️ DUPLICATE DETECTED!\n\nAn issue with identical content already exists. Do you want to save anyway?')) {
                    return;
                }
            }

            // Handle media files
            const mediaFiles = document.getElementById('mediaFiles').files;
            const promises = [];

            for (let file of mediaFiles) {
                promises.push(convertFileToBase64(file));
            }

            try {
                const base64Files = await Promise.all(promises);
                issue.mediaFiles = base64Files;
                
                await saveIssue(issue);
            } catch (error) {
                showNotification('Error processing media files: ' + error.message, 'error');
            }
        });

        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    resolve({
                        name: file.name,
                        type: file.type,
                        data: reader.result
                    });
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function saveIssue(issue) {
            try {
                if (editingIssueId) {
                    // Update existing issue
                    const index = issues.findIndex(i => i.id === editingIssueId);
                    if (index !== -1) {
                        issues[index] = issue;
                    }
                    editingIssueId = null;
                } else {
                    // Add new issue
                    issues.push(issue);
                }

                const saved = await saveDataToGitHub();
                if (saved) {
                    updateDashboard();
                    displayIssueList();
                    resetForm();
                    showNotification('Issue saved successfully!', 'success');
                    
                    // Navigate to issue viewer
                    setTimeout(() => {
                        viewIssueDetails(issue.id);
                    }, 1000);
                }
            } catch (error) {
                showNotification('Error saving issue: ' + error.message, 'error');
            }
        }

        function resetForm() {
            document.getElementById('issueForm').reset();
            document.getElementById('mediaPreview').innerHTML = '';
            recordedAudio = null;
            editingIssueId = null;
            updateVoiceButtons();
        }

        // Media preview
        document.getElementById('mediaFiles').addEventListener('change', function(e) {
            const preview = document.getElementById('mediaPreview');
            preview.innerHTML = '';

            for (let file of e.target.files) {
                const div = document.createElement('div');
                div.style.display = 'inline-block';
                div.style.margin = '10px';

                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'media-preview';
                    div.appendChild(img);
                } else if (file.type.startsWith('audio/')) {
                    const audio = document.createElement('audio');
                    audio.src = URL.createObjectURL(file);
                    audio.controls = true;
                    audio.style.width = '200px';
                    div.appendChild(audio);
                }

                const name = document.createElement('p');
                name.textContent = file.name;
                name.style.color = '#a8e6cf';
                name.style.fontSize = '12px';
                name.style.textAlign = 'center';
                div.appendChild(name);

                preview.appendChild(div);
            }
        });

        // Voice recording functions
        function toggleRecording() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showNotification('Voice recording is not supported in this browser', 'error');
                return;
            }

            if (mediaRecorder && mediaRecorder.state === 'recording') {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const reader = new FileReader();
                        reader.onload = () => {
                            recordedAudio = {
                                name: 'voice_recording_' + Date.now() + '.wav',
                                type: 'audio/wav',
                                data: reader.result
                            };
                            
                            const audioPreview = document.getElementById('audioPreview');
                            audioPreview.src = URL.createObjectURL(audioBlob);
                            audioPreview.style.display = 'block';
                            updateVoiceButtons();
                        };
                        reader.readAsDataURL(audioBlob);
                        
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();
                    updateVoiceButtons();
                    document.getElementById('recordingIndicator').classList.remove('hidden');
                })
                .catch(error => {
                    showNotification('Error accessing microphone: ' + error.message, 'error');
                });
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                document.getElementById('recordingIndicator').classList.add('hidden');
                updateVoiceButtons();
            }
        }

        function playRecording() {
            const audioPreview = document.getElementById('audioPreview');
            if (audioPreview.src) {
                audioPreview.play();
            }
        }

        function updateVoiceButtons() {
            const recordBtn = document.getElementById('recordBtn');
            const stopBtn = document.getElementById('stopBtn');
            const playBtn = document.getElementById('playBtn');

            const isRecording = mediaRecorder && mediaRecorder.state === 'recording';
            
            recordBtn.disabled = isRecording;
            stopBtn.disabled = !isRecording;
            playBtn.disabled = !recordedAudio;

            if (isRecording) {
                recordBtn.textContent = '🎤 Recording...';
                recordBtn.className = 'btn btn-danger';
            } else {
                recordBtn.textContent = '🎤 Start Recording';
                recordBtn.className = 'btn btn-success';
            }
        }

        // Search functionality
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            const statusFilter = document.getElementById('filterStatus')?.value || '';
            const criticalFilter = document.getElementById('filterCritical')?.value || '';
            const categoryFilter = document.getElementById('filterCategory')?.value || '';
            const dateFromFilter = document.getElementById('filterDateFrom')?.value || '';
            const dateToFilter = document.getElementById('filterDateTo')?.value || '';

            let filteredIssues = [...issues];

            // Text search
            if (query) {
                const keywords = query.split(',').map(k => k.trim()).filter(k => k);
                filteredIssues = filteredIssues.filter(issue => {
                    const searchText = (issue.title + ' ' + issue.content + ' ' + (issue.resolutionMethod || '')).toLowerCase();
                    return keywords.some(keyword => searchText.includes(keyword));
                });
            }

            // Status filter
            if (statusFilter) {
                filteredIssues = filteredIssues.filter(issue => issue.status === statusFilter);
            }

            // Critical level filter
            if (criticalFilter) {
                filteredIssues = filteredIssues.filter(issue => issue.criticalLevel === criticalFilter);
            }

            // Category filter
            if (categoryFilter) {
                filteredIssues = filteredIssues.filter(issue => issue.category === categoryFilter);
            }

            // Date filters
            if (dateFromFilter) {
                const fromDate = new Date(dateFromFilter);
                filteredIssues = filteredIssues.filter(issue => new Date(issue.createdDate) >= fromDate);
            }

            if (dateToFilter) {
                const toDate = new Date(dateToFilter + 'T23:59:59');
                filteredIssues = filteredIssues.filter(issue => new Date(issue.createdDate) <= toDate);
            }

            displaySearchResults(filteredIssues);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterCritical').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            performSearch();
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #b8e6b8;">No issues found matching your criteria</p>';
                return;
            }

            const html = results.map(issue => `
                <div class="issue-card glass-dark" onclick="viewIssueDetails('${issue.id}')">
                    <div class="issue-title">${escapeHtml(issue.title)}</div>
                    <div class="issue-meta">
                        Created: ${formatDateTime(issue.createdDate)} | 
                        <span class="status critical-${issue.criticalLevel}">${getCriticalLevelText(issue.criticalLevel)}</span> |
                        <span class="status status-${issue.status === 'finished' ? 'authenticated' : 'unauthenticated'}">${issue.status}</span>
                    </div>
                    <div class="issue-content">${escapeHtml(issue.content)}</div>
                    ${issue.mediaFiles && issue.mediaFiles.length > 0 ? `<div style="color: #a8e6cf; font-size: 0.9em;">📎 ${issue.mediaFiles.length} media file(s)</div>` : ''}
                    ${issue.voiceRecording ? '<div style="color: #a8e6cf; font-size: 0.9em;">🎤 Voice recording available</div>' : ''}
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // Issue List functions
        function sortIssues() {
            const sortBy = document.getElementById('sortBy').value;
            let sortedIssues = [...issues];

            switch (sortBy) {
                case 'date-desc':
                    sortedIssues.sort((a, b) => new Date(b.updatedDate || b.createdDate) - new Date(a.updatedDate || a.createdDate));
                    break;
                case 'date-asc':
                    sortedIssues.sort((a, b) => new Date(a.updatedDate || a.createdDate) - new Date(b.updatedDate || b.createdDate));
                    break;
                case 'title-asc':
                    sortedIssues.sort((a, b) => a.title.localeCompare(b.title));
                    break;
                case 'title-desc':
                    sortedIssues.sort((a, b) => b.title.localeCompare(a.title));
                    break;
                case 'critical':
                    const criticalOrder = { urgent: 4, high: 3, medium: 2, low: 1 };
                    sortedIssues.sort((a, b) => (criticalOrder[b.criticalLevel] || 0) - (criticalOrder[a.criticalLevel] || 0));
                    break;
            }

            displayIssueList(sortedIssues);
        }

        function setViewMode(mode) {
            currentViewMode = mode;
            document.getElementById('viewThumbnails').classList.toggle('active', mode === 'thumbnails');
            document.getElementById('viewTable').classList.toggle('active', mode === 'table');
            displayIssueList();
        }

        function displayIssueList(issuesToDisplay = issues) {
            // Sort issues by default (latest first)
            if (issuesToDisplay === issues) {
                issuesToDisplay = [...issues].sort((a, b) => new Date(b.updatedDate || b.createdDate) - new Date(a.updatedDate || a.createdDate));
            }

            const container = document.getElementById('issueListContent');
            
            if (issuesToDisplay.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #b8e6b8;">No issues found</p>';
                return;
            }

            if (currentViewMode === 'table') {
                const html = `
                    <table class="table-view">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Status</th>
                                <th>Critical</th>
                                <th>Category</th>
                                <th>Created</th>
                                <th>Updated</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${issuesToDisplay.map(issue => `
                                <tr onclick="viewIssueDetails('${issue.id}')" style="cursor: pointer;">
                                    <td>${escapeHtml(issue.title)}</td>
                                    <td><span class="status status-${issue.status === 'finished' ? 'authenticated' : 'unauthenticated'}">${issue.status}</span></td>
                                    <td><span class="status critical-${issue.criticalLevel}">${getCriticalLevelText(issue.criticalLevel)}</span></td>
                                    <td>${issue.category}</td>
                                    <td>${formatDateTime(issue.createdDate)}</td>
                                    <td>${formatDateTime(issue.updatedDate)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                container.innerHTML = html;
            } else {
                const html = issuesToDisplay.map(issue => `
                    <div class="issue-card glass-dark" onclick="viewIssueDetails('${issue.id}')">
                        <div class="issue-title">${escapeHtml(issue.title)}</div>
                        <div class="issue-meta">
                            Created: ${formatDateTime(issue.createdDate)} | 
                            <span class="status critical-${issue.criticalLevel}">${getCriticalLevelText(issue.criticalLevel)}</span> |
                            <span class="status status-${issue.status === 'finished' ? 'authenticated' : 'unauthenticated'}">${issue.status}</span> |
                            Category: ${issue.category}
                        </div>
                        <div class="issue-content">${escapeHtml(issue.content)}</div>
                        ${issue.mediaFiles && issue.mediaFiles.length > 0 ? `<div style="color: #a8e6cf; font-size: 0.9em;">📎 ${issue.mediaFiles.length} media file(s)</div>` : ''}
                        ${issue.voiceRecording ? '<div style="color: #a8e6cf; font-size: 0.9em;">🎤 Voice recording available</div>' : ''}
                    </div>
                `).join('');

                container.innerHTML = html;
            }
        }

        function viewIssueDetails(issueId) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;

            showIssueViewer();
            
            const content = document.getElementById('issueViewerContent');
            content.innerHTML = `
                <div class="glass-dark" style="padding: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                        <h3 style="color: #a8e6cf;">${escapeHtml(issue.title)}</h3>
                        <div>
                            <button class="btn btn-primary" onclick="editIssue('${issue.id}')">✏️ Edit</button>
                            <button class="btn btn-danger" onclick="deleteIssue('${issue.id}')">🗑️ Delete</button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <strong style="color: #a8e6cf;">Status:</strong> 
                            <span class="status status-${issue.status === 'finished' ? 'authenticated' : 'unauthenticated'}">${issue.status}</span>
                        </div>
                        <div>
                            <strong style="color: #a8e6cf;">Critical Level:</strong> 
                            <span class="status critical-${issue.criticalLevel}">${getCriticalLevelText(issue.criticalLevel)}</span>
                        </div>
                        <div>
                            <strong style="color: #a8e6cf;">Category:</strong> ${issue.category}
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <strong style="color: #a8e6cf;">Created:</strong><br>${formatDateTime(issue.createdDate)}
                        </div>
                        <div>
                            <strong style="color: #a8e6cf;">Updated:</strong><br>${formatDateTime(issue.updatedDate)}
                        </div>
                        <div>
                            <strong style="color: #a8e6cf;">Expected Resolution:</strong><br>${formatDateTime(issue.expectedDate)}
                        </div>
                        <div>
                            <strong style="color: #a8e6cf;">Actual Resolution:</strong><br>${formatDateTime(issue.actualDate)}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong style="color: #a8e6cf;">Content:</strong>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 10px; white-space: pre-wrap;">${escapeHtml(issue.content)}</div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong style="color: #a8e6cf;">Resolution Method:</strong>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; margin-top: 10px; white-space: pre-wrap;">${escapeHtml(issue.resolutionMethod || 'Not specified')}</div>
                    </div>
                    
                    ${issue.mediaFiles && issue.mediaFiles.length > 0 ? `
                        <div style="margin-bottom: 20px;">
                            <strong style="color: #a8e6cf;">Media Files:</strong>
                            <div style="margin-top: 10px;">
                                ${issue.mediaFiles.map((file, index) => `
                                    <div style="display: inline-block; margin: 10px; text-align: center;">
                                        ${file.type.startsWith('image/') ? 
                                            `<img src="${file.data}" class="media-preview" alt="${file.name}">` :
                                            `<audio controls style="width: 200px;"><source src="${file.data}" type="${file.type}"></audio>`
                                        }
                                        <p style="color: #a8e6cf; font-size: 12px; margin-top: 5px;">${file.name}</p>
                                        <button class="btn btn-danger btn-sm" onclick="removeMediaFile('${issue.id}', ${index})">Remove</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${issue.voiceRecording ? `
                        <div style="margin-bottom: 20px;">
                            <strong style="color: #a8e6cf;">Voice Recording:</strong>
                            <div style="margin-top: 10px;">
                                <audio controls style="width: 100%;">
                                    <source src="${issue.voiceRecording.data}" type="${issue.voiceRecording.type}">
                                </audio>
                                <br>
                                <button class="btn btn-danger btn-sm" style="margin-top: 10px;" onclick="removeVoiceRecording('${issue.id}')">Remove Voice Recording</button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        async function editIssue(issueId) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;

            showIssueLogger();
            editingIssueId = issueId;

            // Populate form with issue data
            document.getElementById('issueTitle').value = issue.title;
            document.getElementById('issueContent').value = issue.content;
            document.getElementById('criticalLevel').value = issue.criticalLevel || 'low';
            document.getElementById('resolutionMethod').value = issue.resolutionMethod || '';
            document.getElementById('expectedDate').value = issue.expectedDate ? issue.expectedDate.slice(0, 16) : '';
            document.getElementById('actualDate').value = issue.actualDate ? issue.actualDate.slice(0, 16) : '';
            document.getElementById('issueStatus').value = issue.status;
            document.getElementById('category').value = issue.category;

            // Handle existing media
            if (issue.mediaFiles && issue.mediaFiles.length > 0) {
                const preview = document.getElementById('mediaPreview');
                preview.innerHTML = issue.mediaFiles.map((file, index) => `
                    <div style="display: inline-block; margin: 10px; text-align: center;">
                        ${file.type.startsWith('image/') ? 
                            `<img src="${file.data}" class="media-preview" alt="${file.name}">` :
                            `<audio controls style="width: 200px;"><source src="${file.data}" type="${file.type}"></audio>`
                        }
                        <p style="color: #a8e6cf; font-size: 12px; margin-top: 5px;">${file.name}</p>
                    </div>
                `).join('');
            }

            // Handle existing voice recording
            if (issue.voiceRecording) {
                recordedAudio = issue.voiceRecording;
                const audioPreview = document.getElementById('audioPreview');
                audioPreview.src = issue.voiceRecording.data;
                audioPreview.style.display = 'block';
                updateVoiceButtons();
            }

            // Expand the form section if collapsed
            const formSection = document.getElementById('createIssueForm');
            if (formSection.parentElement.classList.contains('collapsed')) {
                toggleCollapse('createIssueForm');
            }
        }

        async function deleteIssue(issueId, confirm = true) {
            if (confirm && !window.confirm('Are you sure you want to delete this issue?')) {
                return;
            }

            try {
                issues = issues.filter(i => i.id !== issueId);
                const saved = await saveDataToGitHub();
                
                if (saved) {
                    displayIssueList();
                    updateDashboard();
                    showNotification('Issue deleted successfully!', 'success');
                    
                    if (confirm) {
                        showIssueList();
                    }
                }
            } catch (error) {
                showNotification('Error deleting issue: ' + error.message, 'error');
            }
        }

        async function removeMediaFile(issueId, fileIndex) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;

            issue.mediaFiles.splice(fileIndex, 1);
            issue.updatedDate = getCurrentDateTime();
            
            const saved = await saveDataToGitHub();
            if (saved) {
                viewIssueDetails(issueId);
                showNotification('Media file removed', 'success');
            }
        }

        async function removeVoiceRecording(issueId) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;

            issue.voiceRecording = null;
            issue.updatedDate = getCurrentDateTime();
            
            const saved = await saveDataToGitHub();
            if (saved) {
                viewIssueDetails(issueId);
                showNotification('Voice recording removed', 'success');
            }
        }

        // Dashboard functions
        function updateDashboard() {
            const totalIssues = issues.length;
            const openIssues = issues.filter(i => i.status !== 'finished').length;
            const closedIssues = issues.filter(i => i.status === 'finished').length;

            document.getElementById('totalIssues').textContent = totalIssues;
            document.getElementById('openIssues').textContent = openIssues;
            document.getElementById('closedIssues').textContent = closedIssues;

            // Critical level statistics
            const criticalStats = {
                low: issues.filter(i => i.status !== 'finished' && i.criticalLevel === 'low').length,
                medium: issues.filter(i => i.status !== 'finished' && i.criticalLevel === 'medium').length,
                high: issues.filter(i => i.status !== 'finished' && i.criticalLevel === 'high').length,
                urgent: issues.filter(i => i.status !== 'finished' && i.criticalLevel === 'urgent').length
            };

            const criticalStatsHtml = Object.entries(criticalStats).map(([level, count]) => `
                <div class="glass-dark" style="padding: 15px; text-align: center;">
                    <h5 style="color: #a8e6cf;">${getCriticalLevelText(level)}</h5>
                    <div style="font-size: 1.5em; color: #ffffff;">${count}</div>
                </div>
            `).join('');

            document.getElementById('criticalLevelStats').innerHTML = criticalStatsHtml;

            // Show recent issues
            const recentIssues = issues.slice(-5).reverse();
            const recentContainer = document.getElementById('recentIssues');
            
            if (recentIssues.length === 0) {
                recentContainer.innerHTML = '<p style="text-align: center; color: #b8e6b8;">No issues found</p>';
                return;
            }

            const html = recentIssues.map(issue => `
                <div class="issue-card glass-dark" onclick="viewIssueDetails('${issue.id}')">
                    <div class="issue-title">${escapeHtml(issue.title)}</div>
                    <div class="issue-meta">
                        ${formatDateTime(issue.createdDate)} | 
                        <span class="status critical-${issue.criticalLevel}">${getCriticalLevelText(issue.criticalLevel)}</span> |
                        <span class="status status-${issue.status === 'finished' ? 'authenticated' : 'unauthenticated'}">${issue.status}</span>
                    </div>
                </div>
            `).join('');

            recentContainer.innerHTML = html;
        }

        // Report functions
        function generateReport() {
            const closedIssues = issues.filter(i => i.status === 'finished');
            const totalResolutionTime = closedIssues.reduce((total, issue) => {
                if (issue.createdDate && issue.actualDate) {
                    const created = new Date(issue.createdDate);
                    const resolved = new Date(issue.actualDate);
                    return total + (resolved - created);
                }
                return total;
            }, 0);

            const avgResolutionTime = closedIssues.length > 0 ? totalResolutionTime / closedIssues.length : 0;
            const avgDays = Math.round(avgResolutionTime / (1000 * 60 * 60 * 24));

            const criticalBreakdown = {
                low: closedIssues.filter(i => i.criticalLevel === 'low').length,
                medium: closedIssues.filter(i => i.criticalLevel === 'medium').length,
                high: closedIssues.filter(i => i.criticalLevel === 'high').length,
                urgent: closedIssues.filter(i => i.criticalLevel === 'urgent').length
            };

            const summary = document.getElementById('reportSummary');
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <div style="color: #a8e6cf; font-weight: bold;">Total Closed</div>
                        <div style="font-size: 1.5em; color: #ffffff;">${closedIssues.length}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #a8e6cf; font-weight: bold;">Avg Resolution Time</div>
                        <div style="font-size: 1.5em; color: #ffffff;">${avgDays} days</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="color: #a8e6cf; font-weight: bold;">Resolution Rate</div>
                        <div style="font-size: 1.5em; color: #ffffff;">${issues.length > 0 ? Math.round((closedIssues.length / issues.length) * 100) : 0}%</div>
                    </div>
                </div>
                
                <h4 style="color: #a8e6cf; margin-bottom: 15px;">Closed Issues by Critical Level</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                    ${Object.entries(criticalBreakdown).map(([level, count]) => `
                        <div style="text-align: center;">
                            <div style="color: #a8e6cf; font-weight: bold;">${getCriticalLevelText(level)}</div>
                            <div style="font-size: 1.3em; color: #ffffff;">${count}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            const closedList = document.getElementById('closedIssuesList');
            if (closedIssues.length === 0) {
                closedList.innerHTML = '<p style="text-align: center; color: #b8e6b8;">No closed issues found</p>';
                return;
            }

            const html = closedIssues.map(issue => `
                <div class="issue-card glass-dark" onclick="viewIssueDetails('${issue.id}')">
                    <div class="issue-title">${escapeHtml(issue.title)}</div>
                    <div class="issue-meta">
                        Closed: ${formatDateTime(issue.actualDate)} | 
                        <span class="status critical-${issue.criticalLevel}">${getCriticalLevelText(issue.criticalLevel)}</span> |
                        Category: ${issue.category}
                    </div>
                    <div class="issue-content">${escapeHtml(issue.content)}</div>
                </div>
            `).join('');

            closedList.innerHTML = html;
        }

        // Category management
        function populateCategories() {
            const categorySelects = ['category', 'filterCategory'];
            categorySelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
                    if (currentValue) select.value = currentValue;
                }
            });
        }

        function populateFilterCategories() {
            const filterSelect = document.getElementById('filterCategory');
            filterSelect.innerHTML = '<option value="">All Categories</option>' + 
                categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
        }

        function displayCategories() {
            const container = document.getElementById('categoriesList');
            
            if (categories.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #b8e6b8;">No categories found</p>';
                return;
            }

            const html = categories.map(category => `
                <div class="glass-dark" style="padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4 style="color: #a8e6cf; margin-bottom: 5px;">${escapeHtml(category.name)}</h4>
                        <p style="color: #b8e6b8; margin: 0;">${escapeHtml(category.description || 'No description')}</p>
                    </div>
                    <div>
                        <button class="btn btn-warning btn-sm" onclick="editCategory('${category.id}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCategory('${category.id}')">Delete</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        document.getElementById('categoryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('categoryName').value.trim();
            const description = document.getElementById('categoryDescription').value.trim();
            
            if (!name) {
                showNotification('Please enter a category name', 'error');
                return;
            }

            const id = name.toLowerCase().replace(/[^a-z0-9]/g, '_');
            
            // Check for duplicate
            if (categories.some(cat => cat.id === id)) {
                showNotification('Category already exists', 'error');
                return;
            }

            categories.push({ id, name, description });
            
            const saved = await saveDataToGitHub();
            if (saved) {
                populateCategories();
                displayCategories();
                document.getElementById('categoryForm').reset();
                showNotification('Category added successfully!', 'success');
            }
        });

        function editCategory(categoryId) {
            const category = categories.find(c => c.id === categoryId);
            if (!category) return;

            const newName = prompt('Enter new category name:', category.name);
            if (!newName || newName.trim() === '') return;

            const newDescription = prompt('Enter new description:', category.description || '');

            category.name = newName.trim();
            category.description = newDescription ? newDescription.trim() : '';

            saveDataToGitHub().then(saved => {
                if (saved) {
                    populateCategories();
                    displayCategories();
                    showNotification('Category updated successfully!', 'success');
                }
            });
        }

        async function deleteCategory(categoryId) {
            if (!confirm('Are you sure you want to delete this category?')) return;

            const issuesUsingCategory = issues.filter(issue => issue.category === categoryId);
            if (issuesUsingCategory.length > 0) {
                showNotification(`Cannot delete category: ${issuesUsingCategory.length} issue(s) are using it`, 'error');
                return;
            }

            categories = categories.filter(c => c.id !== categoryId);
            
            const saved = await saveDataToGitHub();
            if (saved) {
                populateCategories();
                displayCategories();
                showNotification('Category deleted successfully!', 'success');
            }
        }

        // Utility functions
        function getCriticalLevelText(level) {
            const levels = {
                low: '🟢 Low',
                medium: '🟡 Medium',
                high: '🟠 High',
                urgent: '🔴 Urgent'
            };
            return levels[level] || level;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        async function refreshData() {
            await loadDataFromGitHub();
            updateDashboard();
            displayIssueList();
            showNotification('Data refreshed successfully!', 'success');
        }

        // Initialize voice recording buttons
        updateVoiceButtons();
    </script>
</body>
</html>
